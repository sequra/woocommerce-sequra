#!/bin/bash
BASEDIR="$(dirname $(realpath $0))/.."
cd "${BASEDIR}"

# Install only production dependencies
bin/composer install --no-dev
bin/npm run build

# Check if --headed is passed
if [[ "$@" == *"--headed"* ]]; then

    set -o allexport
    source .env
    set +o allexport

    cd sequra && npx playwright test $@
else
    docker run \
    --env-file "${BASEDIR}"/.env \
    -it --rm -v "${BASEDIR}"/sequra:/app -w /app mcr.microsoft.com/playwright:v1.45.0-jammy bash -c "npx playwright test $@"
fi
